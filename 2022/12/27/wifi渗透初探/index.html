<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>wifi渗透初探 | Ly's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">wifi渗透初探</h1><a id="logo" href="/.">Ly's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">wifi渗透初探</h1><div class="post-meta">2022-12-27<span> | </span><span class="category"><a href="/categories/toy/">toy</a></span></div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h2><p>最近新买的linux监听网卡到了，借此学习一下wifi相关技术及原理。本文章主要以WPA &#x2F; WPA2 加密的设备做演示。</p>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a><strong>基础知识</strong></h2><p><strong>普通无线加密及破解的分类：</strong> 1、wep加密：一种老旧的加密方式，十分容易被攻击，已被大多设备舍弃 2、WPA&#x2F;WPA2 加密：当下wifi设备主流的加密模式，相对比较安全，一般采用抓取握手包进行本地字典攻击的方式进行破解，或利用钓鱼手段，对于开启QSS快速连接功能的路由器也可采用pin码穷举来加入无线网络</p>
<h3 id="wifi-四次握手："><a href="#wifi-四次握手：" class="headerlink" title="wifi****四次握手："></a><strong>wifi****四次握手：</strong></h3><p>1、首先AP发起四次握手，AP发送一条包含ANonce（随机值）的消息到客户端。 2、客户端利用它来生成PTK。这个过程中客户端先自行生成PMK&#x3D;Hash(ESSID+PSK+4096)，然后用PMK在生成PTK &#x3D; PRF (PMK + ANonce + SNonce + Mac (AA)+ Mac (SA))。最后将Mic&#x3D;Hash(PTK+ANonce+SNonce+MAC1+MAC2)的值以及生成的随机值SNonce一同发送给AP。<img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F1.png"> 3、AP利用客户端发来的SNonce，自己也生成一个Mic，并去校验生成的Mic和客户端发来的Mic是否相等，相等的话即代表PSK(密码)正确。然后将自己生成的Mic和GTK(临时组密钥)发送给客户端。 4、客户端确认AP发来的Mic并缓存GTK的广播组密钥</p>
<h3 id="密码破解原理："><a href="#密码破解原理：" class="headerlink" title="密码破解原理："></a><strong>密码破解原理：</strong></h3><p>了解了wifi握手过程我们可以发现，在一系列设备交互中，唯一不可知的只有PSK，也就是我们wifi连接时需要的密码。知道了这个特点便可以抓取握手包利用字典暴力破解PSK，这就是握手包破解密码的基本原理。 下面使用kali来破解wifi密码</p>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a><strong>实战</strong></h2><p>首先插入linux网卡（一定要带有监听模式的），在命令窗口查看网卡接入情况，这里的wlan0便是我的外接网卡了 <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F2.png"> 确认网卡装配无误，开启网卡监听模式</p>
<blockquote>
<p>airmon-ng start wlan0</p>
</blockquote>
<p><img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F3.png"> 再用ifconfig查看网卡情况，wlan0变成了wlan0mon就说明开启成功 <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F4.png"> 探测周边wifi，这里的Test便是我们的目标wifi</p>
<blockquote>
<p>airodump-ng wlan0mon</p>
</blockquote>
<p><img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F5.png"> 记下当前信道为6，以及BSSID 选中该wifi进行监听</p>
<blockquote>
<p>airodump-ng –bssid 42:EC:99:EE:E5:26 -c 6 -w Test wlan0mon</p>
</blockquote>
<p><img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F6.png"> 可以看到当前一个用户已经接入wifi设备，但握手包是在用户连接wifi认证时才能捕获到，如果用户已经连接正在使用是无法捕获到的，所以我们需要等待一个恰好要连接的用户，当然，在长时间等不到用户来连接的时候，我们可以打开另一个终端对已接入设备进行Deauth 攻击，迫使其掉线重新进行认证。 保留上面的监听窗口，重新打开一个命令窗口对正在连接使用的用户进行Deauth 攻击</p>
<blockquote>
<p>aireplay-ng -0 10 -a 42:EC:99:EE:E5:26 -c 1E:76:F6:57:E1:93 wlan0mon</p>
</blockquote>
<p><img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F7.png"> 在攻击过程中，该用户会不断掉线并重新认证，直到窗口出现下图的WPA handshake字样，我们就成功捕获了握手包 <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F8.png"> 接下来查看当前目录，找到wifi名字对应的cap文件，这就是我们抓到的包 <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F9.png"> 对握手包进行本地解密需要一个强大的字典，这里我用字母和符号随机生成了一个字典进行爆破，爆破成功后密码会显示到命令行，实战中可以说只要字典够强，机器性能够强，理论上是可以100%破解成功的，但现实并不是那么理想，个人PC的性能跑一个包罗万象的字典可能要到猴年马月，所以还是需要一定运气。</p>
<blockquote>
<p>aircrack-ng -w 字典路径 cap包路径</p>
</blockquote>
<p><img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F10.png"></p>
<h3 id="PIN码穷举："><a href="#PIN码穷举：" class="headerlink" title="PIN码穷举："></a><strong>PIN码穷举：</strong></h3><p>如果是开启QSS快速连接功能的路由器也可以对目标尝试pin码穷举，PIN码共为8位，按4 3 1 分段，总共穷举有11000种组合。通过爆破获取到PIN码并已知Bssid就可以得到wifi密码。</p>
<blockquote>
<p>reaver -i wlan0mon -b 70:85:c4:6B:71:8F -vv</p>
</blockquote>
<p><img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F11.png"> 这个过程会很慢，因为中途会出现PIN死的情况，但最终一定可以得到Wifi的PIN码和密码，相对于抓握手包进行爆破的不确定性，这种方法省力得多，而且PIN码一般没人去刻意更改，如果用户将wifi密码更改的话，还是可以通过一条指令用PIN码来获得Wifi密码</p>
<blockquote>
<p>reaver -i wlan0mon -b MAC地址 -p PIN码</p>
</blockquote>
<h3 id="图片窃取"><a href="#图片窃取" class="headerlink" title="图片窃取"></a><strong>图片窃取</strong></h3><p>在拿到wifi密码后并连接后成功加入局域网，我们就可以利用ARP欺骗来窃取用户图片 首先我们利用nmap来扫描局域网存活主机</p>
<blockquote>
<p>namp -sP 192.168.5.0&#x2F;24</p>
</blockquote>
<p><img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F12.png"> 扫描后发现除了我们还有两台主机，其中ip为192.168.5.12的是一台安卓设备，我们将这台设备作为攻击目标 在对受害者实施ARP欺骗将自己的设备作为网关后，如果攻击者将自己的网卡开启流量转发，将截获的数据包传递到真正的网关，就可让受害主机不断网，同时我们也可以监听到受害者主机的数据流量的内容。 Vim编辑&#x2F;etc&#x2F;svsctl.conf文件，去掉net.ipv4.ip_forward&#x3D;1的注释即可开启端口转发 <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F13.png"> 首先开启ARP欺骗</p>
<blockquote>
<p>arpspoof -i wlan0 -t 192.168.5.1 192.168.5.12</p>
</blockquote>
<p><img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F14.png"> 打开另一个终端执行driftnet -i wlan0 -a -d &#x2F;testpic，它就会自动把手机浏览的图片保存到&#x2F;testpic下 <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F15.png"> 此时我们用手机浏览一篇关于疫情的帖子，命令窗口立即捕获了图片 <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F16.png"> 下面是此时手机正在浏览的页面，百度搜索了疫情，浏览页面中出现了图片 <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F18.png"> 此时查看kali捕获到对应请求图片，与访问的图片一致 <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F17.png">  </p>
<h3 id="密码截获"><a href="#密码截获" class="headerlink" title="密码截获"></a><strong>密码截获</strong></h3><p>如果说我们拿到同一wifi下设备访问的图片只是隐私泄露，但如果账号密码被截获就是真正的损失了 这里我们选择win11主机为受害者，模拟在网站登录，这里我也发现https的站点一般情况下似乎捕获不到账号密码信息，看了其他大佬的文章也是用http网站进行测试，这里就借用别人文章中的http站点进行演示 <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F19.png"> Kali攻击机一个窗口对其进行arp欺骗，另一个窗口利用ettercap工具捕获账号密码 <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F20.png"> Win11机器在http站点登录后，回到kali看到账号密码已被捕获（此处密码为md5加密，部分站点的密码是明文） <img src="https://lyblog-1309143339.cos.ap-beijing.myqcloud.com/wifi%E6%B8%97%E9%80%8F%E5%88%9D%E6%8E%A2%2F21.png"> 将md5撞库后得到账号密码，如果md5复杂撞库得不到原始密码，也可以用bp抓登陆包替换密码的md5值进行登录  </p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a><strong>其他</strong></h2><p>在加入局域网成功进行arp欺骗后还有很多其他的操作可以实现，例如替换数据，替换浏览器访问页面、钓鱼等</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2><p>虽然当今各种安全协议完善，但还是无法避免有心之人利用，在使用wifi设备时应注意信息安全。根据上述实验内容来看，可做如下几点防护：</p>
<ul>
<li>不随意连接陌生Wifi</li>
<li>个人Wifi密码采用字母大小写、数字、符号混合的形式</li>
<li>没有需求的话尽量关闭路由器的wps功能</li>
<li>在管理页面发现陌生设备及时封杀并修改密码</li>
<li>Wifi万能钥匙一类软件会共享出自己wifi的密码，尽量不要使用</li>
<li>一般家用环境下可以开启ap隔离防止局域网内的攻击</li>
</ul>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/toy/" rel="tag">toy</a></li></ul></div><div class="post-nav"><a class="pre" href="/2023/02/14/python%E5%AE%9E%E7%8E%B0%E6%A2%85%E8%8A%B1%E6%98%93%E6%95%B0%E7%AE%80%E6%98%93%E6%8E%92%E7%9B%98/">python实现梅花易数简易排盘</a><a class="next" href="/2022/11/10/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%A0%A1%E5%9B%AD%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">记一次校园网渗透测试</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="About"><img class="nofancybox" src="/img/avatar.png"/></a><p>寻不到答案，便去寻自己</p></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/toy/">toy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web%E5%AE%89%E5%85%A8/">web安全</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/web%E5%AE%89%E5%85%A8/" style="font-size: 15px;">web安全</a> <a href="/tags/toy/" style="font-size: 15px;">toy</a> <a href="/tags/ctf/" style="font-size: 15px;">ctf</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/java/" style="font-size: 15px;">java</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2024/02/28/%E8%AE%B0%E4%B8%80%E6%AC%A1sql%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87%E5%AE%9E%E6%88%98/">记一次sql注入绕过实战</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/11/13/510/">记一次娱乐测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/10/18/vulnhub-dc3%E9%9D%B6%E5%9C%BA/">vulnhub-DC3靶场</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/13/vulnhub%E6%89%93%E9%9D%B6%E9%9B%86%E5%90%88/">Vulnhub打靶集合</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/11/laravel-debug-mode-rce%EF%BC%88cve-2021-3129%EF%BC%89%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">Laravel Debug mode RCE（CVE-2021-3129）漏洞复现</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/05/25/selenium%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/">selenium自动化工具的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/05/13/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA%E6%94%BB%E5%85%8B%E7%AC%94%E8%AE%B0%E5%9B%9B/">红日靶场攻克笔记四</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/04/20/%E7%94%B5%E5%AD%90%E5%8F%96%E8%AF%81%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/">电子取证入门指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/04/17/%E5%85%B3%E4%BA%8E%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%AB%99%E7%82%B9%E7%9A%84%E5%9F%BA%E7%A1%80%E9%98%B2%E6%8A%A4/">关于个人博客站点的基础防护</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/04/11/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA%E6%94%BB%E5%85%8B%E7%AC%94%E8%AE%B0%E4%BA%8C/">红日靶场攻克笔记二</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">Ly's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>